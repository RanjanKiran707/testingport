import 'dart:convert';
import 'dart:typed_data';
import 'dart:ui';

import 'package:convert/convert.dart';
import 'package:flutter/foundation.dart';
import "dart:html" as html;
import 'package:flutter/material.dart';
import 'package:flutter/services.dart';
import 'package:get/get.dart';
import "package:image/image.dart" as img;
import 'package:pretty_qr_code/pretty_qr_code.dart';
import 'package:screenshot/screenshot.dart';
import 'package:test/raster.dart';

void main() {
  runApp(const MyApp());
}

String pos = "0207190101";
String end = "02071900";
String imgHex =
    "00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000924924924924804900900092400024804924924924924003FFFFFFFFFFFF80FF03FC0FFFF0007F80FFFFFFFFFFFFE001FFFFFFFFFFFF80FF03FC0FFFF0007F80FFFFFFFFFFFFC001FFFFFFFFFFFF80FF03FC0FFFF0007F80FFFFFFFFFFFFC003FFFFFFFFFFFF80FF03FC0FFFF0007F80FFFFFFFFFFFFE001FFFFFFFFFFFF80FF03FC0FFFF0007F80FFFFFFFFFFFFC001FFFFFFFFFFFF80FF03FC0FFFF0007F80FFFFFFFFFFFFC003FFFFFFFFFFFF80FF23FC8FFFF0007F80FFFFFFFFFFFFE001FC000000007F8001FFFFFFFFF0000000FF000000001FC001FC000000007F8001FFFFFFFFF0000000FE000000001FC003FC000000003F8001FFFFFFFFF0000000FF000000001FE001FC000000007F8001FFFFFFFFF0000000FE000000001FC001FC000000003F8001FFFFFFFFF0000000FF000000001FC003FC000000007F8001FFFFFFFFF0000000FE000000001FE001FC040000003F8001FFFFFFFFF0000000FF000000001FC001FC07FFFFE07F80FFFFFC000FFFE07F80FE03FFFFF01FC003FC07FFFFE03F80FFFFFC000FFFE07F80FF03FFFFF01FE001FC07FFFFE07F80FFFFFC000FFFE07F80FE03FFFFF01FC001FC07FFFFE03F80FFFFFC000FFFE07F80FF03FFFFF01FC003FC07FFFFE07F80FFFFFC000FFFE07F80FE03FFFFF01FE001FC07FFFFE03F80FFFFFC000FFFE07F80FF03FFFFF01FC001FC07FFFFE07F80FFFFFC000FFFE07F80FE03FFFFF01FC003FC07FFFFE03F80FFFFFC05EFFFE00000FF03FFFFE01FE001FC07FFFFE07F80FFFFFC0FFFFFE00000FE03FFFFF01FC001FC07FFFFE03F80FFFFFC0FFFFFE00000FF03FFFFF01FC003FC07FFFFE07F80FFFFFC0FFFFFE00000FE03FFFFF01FE001FC07FFFFE03F80FFFFFC0FFFFFE00000FF03FFFFF01FC001FC07FFFFE07F80FFFFFC0FFFFFE00000FE03FFFFF01FC003FC07FFFFE03F80FFFFFC0FFFFFE00000FF03FFFFF01FE001FC07FFFFE07F80FFFFFDDFFFFFFBBB00FE03FFFFF01FC001FC0FFFFFE03F80FF0007FFF0003FFF80FF03FFFFF01FC003FC07FFFFE07F80FF0007FFF0003FFF80FE03FFFFF01FE001FC07FFFFE03F80FF0007FFF0003FFF80FF03FFFFF01FC001FC07FFFFE07F80FF0007FFF0003FFF80FE03FFFFF01FC003FC07FFFFE03F80FF0007FFF0003FFF80FF03FFFFF01FE001FC07FFFFE07F80FF0007FFF0003FFF80FE03FFFFF01FC001FC07FFFFE03F80FF016FFFF6C03FFF80FF03FFFFF01FC003FC000000007F800003FFF80FF0000000FE000000001FE001FC000000003F800003FFF80FF0000000FF000000001FC001FC000000007F800003FFF80FF0000000FE000000001FC003FC000000003F800003FFF80FF0000000FF000000001FE001FC000000007F800003FFF80FF0000000FE000000001FC001FC000000003F800003FFF80FF0000000FF000000001FC003FEAAAAAAAAFF805503FFFAAFFAA02A80FF555555557FE001FFFFFFFFFFFF80FF03FC0FF01FE07F80FFFFFFFFFFFFC001FFFFFFFFFFFF80FF03FC0FF01FE07F80FFFFFFFFFFFFC003FFFFFFFFFFFF80FF03FC0FF01FE07F80FFFFFFFFFFFFE001FFFFFFFFFFFF80FF03FC0FF01FE07F80FFFFFFFFFFFFC001FFFFFFFFFFFF80FF03FC0FF01FE07F80FFFFFFFFFFFFC003FFFFFFFFFFFF80FF03FC0FF01FE07F80FFFFFFFFFFFFE001FFFFFFFFFFFF80FF03FC0FF01FEAFF80FFFFFFFFFFFFC000000000000000000003FC07F01FFFC0000000000000000000000000000000000003FC0FF01FFFC0000000000000000000000000000000000003FC0FF01FFFC0000000000000000000000000000000000003FC0FF01FFFC0000000000000000000000000000000000003FC0FF01FFFC0000000000000000000000000000000000003FC0FF01FFFC0000000000000000000000000000000000003FC0FF01FFFC0000000000000000003FFFFFFF0007F80FF03FFFFFFE00000FF0003FFFFE01FE001FFFFFFF0003F80FF03FFFFFFF00000FF0003FFFFF01FC001FFFFFFF0007F80FF03FFFFFFF00000FF0003FFFFF01FC003FFFFFFF0003F80FF03FFFFFFF00000FF0003FFFFF01FE001FFFFFFF0007F80FF03FFFFFFF00000FF0003FFFFF01FC001FFFFFFF0003F80FF03FFFFFFF00000FF0003FFFFF01FC003FFFFFFF0007F80FF03FFFFFFF00000FF0003FFFFF01FE001FFFFFFFFFFFF80FF03FFFFFFF0007FFF01FFFFFFF01FC00003F8001FFFC0000003FC0FFFF0007F8001FE000FF000000003F8001FFFC0000003FC07FFF0007F8001FC000FF000000003F8001FFFC0000003FC0FFFF0007F8001FE000FF000000007F8000FFFC0000003FC0FFFF0007F8001FE000FF000000003F8001FFFC0000003FC0FFFF0007F8001FC000FF000000003F8001FFFC0000003FC0FFFF0007F8001FE000FF0000001FFF8001FFFFFFFFFFFFFFFFFF0007F80FFFFF80FF0000001FC00000FFFFFFFFFFFFFFFFFF0000000FE03FC0000000001FC00001FFFFFFFFFFFFFFFFFF0000000FF03FC0000000003FC00001FFFFFFFFFFFFFFFFFF0000000FE03FC0000000001FC00001FFFFFFFFFFFFFFFFFF0000000FF03F80000000001FC00000FFFFFFFFFFFFFFFFFF0000000FE03FC0000000003FC00001FFFFFFFFFFFFFFFFFF0000000FF03FC0000000001FC07F01FFFFFFFFFFFFFFFFFF0007FFFFE03FFFFFFE000000007F01FFFC000FFFFFC000000007FFFFF0007FFFFE000000007F00FFFC000FFFFFC000000007FFFFE0007FFFFE000000007F01FFFC000FFFFFC000000007FFFFF0007FFFFF000000007F81FFFC000FFFFFC000000007FFFFE0007FFFFE000000007F01FFFC000FFFFFC000000007FFFFF0007FFFFE000000007F00FFFC000FFFFFC000000007FFFFE0007FFFFE0000003FFF01FFFFFFFFFFFFC07E01FFFFFFFFFFFFFFFFFFFC00007FFF0003FFFFFFFFFFC0FF01FFFC000FFFFFFFFFFFFC00003FFF0003FFFFFFFFFFC07F01FFFC000FFFFFFFFFFFFC00003FFF0001FFFFFFFFFFC0FF01FFFC000FFFFFFFFFFFFE00003FFF0003FFFFFFFFFFC0FF01FFFC000FFFFFFFFFFFFC00007FFF8003FFFFFFFFFFC0FF01FFFC000FFFFFFFFFFFFC00003FFF0001FFFFFFFFFFC0FF01FFFC000FFFFFFFFFFFFE00003FFF0003FFFFFFFFFFC0FF01FFFC000FFFFFFFFFFFFC0000007F00FE00000000007FFF01FFFC0FFFFFFFC000FFFC0000007F01FE00000000007FFF01FFFC0FFFFFFFC000FFFE0000007F01FE00000000007FFF01FFFC0FFFFFFF8000FFFC0000007F01FE00000000007FFF01FFFC0FFFFFFFC000FFFC0000007F00FE00000000007FFF01FFFC0FFFFFFFC000FFFE0000007F01FE00000000007FFF01FFFC0FFFFFFF8000FFFC0000007F01FE00000000007FFF01FFFC0FFFFFFFC000FFFC00007FFFFFFFFFFFFFFFE07FFFFFFFFFFFFFFFFFFF80FFFC00003FFFFF03FFFFFFFFE07F80FF0007F8001FC07F00FE0000003FFFFF03FFFFFFFFE07F80FF0007F8001FE07F80FE0000003FFFFF01FFFFFFFFE07F80FF0007F8001FE07F80FF0000007FFFFF03FFFFFFFFE07F80FF0007F8001FC07F80FE0000003FFFFF03FFFFFFFFE07F80FF0007F8001FE07F80FE0000003FFFFF01FFFFFFFFE07F80FF0007F8001FE07F80FE00001FFFFFFF03FFFFFFFFE07F80FFFE07F80FFFC07F00FF00001FC000FF03FC000FFFE07F8001FE00000FE0000000FE00003FC000FF01FC000FFFE07F8001FE00000FF0000000FE00001FC000FF03FC000FFFE07F8001FE00000FE0000000FE00001FC000FF03FC000FFFE07F8001FE00000FF0000000FF00003FC000FF01FC000FFFE07F8001FE00000FE0000000FE00001FC000FF03FC000FFFE07F8001FE00000FF0000000FE00001FC000FFFFFFFFFFFFFFFFFF01FE07FFFFFFFF80FFFE00000000007FFE03FFF01FFFC0FF01FE07FFFFFFFFC0FF000000000000FFFE07FFF01FFFC07F01FE07FFFFFFFFC0FF000000000000FFFE03FFF01FFFC0FF01FE07FFFFFFFFC0FF000000000000FFFE07FFF01FFFC0FF01FE07FFFFFFFF80FF000000000000FFFE03FFF01FFFC0FF01FE07FFFFFFFFC0FF000000000000FFFE07FFF01FFFC0FF01FE07FFFFFFFFC0FF000000000000FFFE03FFFFFFFFC0FF01FFFFFFFFFFFFFFFFFE0000000000000000000FF03FC00001FFFFF800003FFF80FF0000000000000000000FF03FC00001FFFFF800003FFF80FE0000000000000000000FF03FC00001FFFFF800003FFF80FE0000000000000000000FF03FC00001FFFFF800003FFF80FE0000000000000000000FF03FC00001FFFFF800003FFF80FF0000000000000000000FF03FC00001FFFFF800003FFF80FE0000000000000000000FF03FC00001FFFFF800003FFF80FE00003FFFFFFFFFFFF80000000000FFFE07F80FF03F80FFFFFC001FFFFFFFFFFFF80000000000FFFE07F80FE03FC0FFFFFC001FFFFFFFFFFFF80000000000FFFE07F80FF03FC0FFFFFE003FFFFFFFFFFFF80000000000FFFE07F80FE03FC0FFFFFC001FFFFFFFFFFFF80000000000FFFE07F80FF03F80FFFFFC001FFFFFFFFFFFF80000000000FFFE07F80FE03FC0FFFFFE003FFFFFFFFFFFF80000000000FFFE07F80FF03FC0FFFFFC001FEAAAAAAAAFF8001FE07F80FFFFFFF80AA03FFFAAABFC001FC000000007F8001FE07F80FFFFFFF800003FFF8001FE003FC000000003F8001FE07F80FFFFFFF800003FFF8001FC001FC000000007F8001FE07F80FFFFFFF800003FFF8001FC001FC000000003F8001FE07F80FFFFFFF800003FFF8001FE003FC000000007F8001FE07F80FFFFFFF800003FFF8001FC001FC000000003F8001FE07F80FFFFFFF800003FFF8001FC001FC07FFFFE07F8000DBFED00FFFF6FFFFFFFFFDB00016C003FC07FFFFE03F800003FC000FFFE07FFFFFFFFC0000000001FC07FFFFE07F800003FC000FFFE07FFFFFFFFC0000000001FC07FFFFE03F800003FC000FFFE07FFFFFFFF80000000003FC0FFFFFE07F800003FC000FFFE07FFFFFFFFC0000000001FC07FFFFE03F800003FC000FFFE07FFFFFFFFC0000000001FC07FFFFE07F800003FC000FFFE07FFFFFFFFC0000000003FC07FFFFE03F80FF01D8000DDDC05DFFFFBBF80FFFFFC001FC07FFFFE07F80FF00000000000000FFFF03FC0FFFFFE001FC07FFFFE03F80FF00000000000000FFFE03FC0FFFFFC003FC07FFFFE07F80FF00000000000000FFFF03FC0FFFFFC001FC07FFFFE03F80FF00000000000000FFFE03F80FFFFFE001FC0FFFFFE07F80FF00000000000000FFFF03FC0FFFFFC003FC07FFFFE03F80FF00000000000000FFFE03FC0FFFFFC001FC07FFFFE07F80FFFFFC00001FFFC0FFFF03FFFBFFFFC001FC07FFFFE03F80FFFFFC00001FFFC0FFFE03FFF80FE00003FC07FFFFE07F80FFFFFC00001FFFC0FFFF03FFF80FE00001FC07FFFFE03F80FFFFFC00001FFFC0FFFE03FFF80FF00001FC07FFFFE07F80FFFFFC00001FFFC0FFFF03FFF80FE00003FC07FFFFE03F80FFFFFC00001FFFC0FFFE03FFF80FE00001FC07FFFFE07F80FFFFFC00001FFFC0FFFF03FFF80FE00001FC07FFFFE03F80FFFFF800001FFFC0FFFE03FFF80FE00003FC000000007F80FFFE07FFFFFFFFC0FFFF0007FFF0000001FC000000003F80FFFE07FFFFFFFFC0FFFE0007FFF0000001FC000000007F80FFFE07FFFFFFFFC0FFFF0007FFF0000003FC000000003F80FFFE07FFFFFFFFC0FFFE0007FFF0000001FC000000007F80FFFE07FFFFFFFFC0FFFF0007FFF0000001FC000000003F80FFFE07FFFFFFFFC0FFFF0007FFF0000003FC000000007F80FFFE07FFFFFFFFC0FFFE0007FFF0000001FFFFFFFFFFFF80FF23FFF904444400FF23FE07FFFFFFC001FFFFFFFFFFFF80FF03FFF800000000FF01FC07FFFFFFC003FFFFFFFFFFFF80FF03FFF800000000FF01FE07FFFFFFE001FFFFFFFFFFFF80FF03FFF800000000FF01FE07FFFFFFC001FFFFFFFFFFFF80FF03FFF800000000FF01FC07FFFFFFC003FFFFFFFFFFFF80FF03FFF800000000FF01FE07FFFFFFE001FFFFFFFFFFFF80FF03FFF800000000FF01FE07FFFFFFC0009249249249248049009248000000004900900249249240000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";

class MyApp extends StatelessWidget {
  const MyApp({super.key});

  // This widget is the root of your application.
  @override
  Widget build(BuildContext context) {
    return GetMaterialApp(
      title: 'Flutter Demo',
      theme: ThemeData(
        primarySwatch: Colors.blue,
      ),
      home: const MyHomePage(),
    );
  }
}

class MyHomePage extends StatefulWidget {
  const MyHomePage({super.key});

  @override
  State<MyHomePage> createState() => _MyHomePageState();
}

class _MyHomePageState extends State<MyHomePage> {
  final ctrl = ScreenshotController();
  final gkey = GlobalKey();
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      floatingActionButton: FloatingActionButton(
        onPressed: () async {
          final qrimage = await ScreenshotController.widgetToUiImage(PrettyQr(
            data: "Ranajn",
            size: 192,
          ));

          final qrBytes =
              (await qrimage.toByteData(format: ImageByteFormat.png))!
                  .buffer
                  .asUint8List();
          img.Image? image = img.decodePng(qrBytes.toList());

          image = img.copyResize(image!, width: 192, height: 192);

          final assetImage = await rootBundle.load("assets/ui.png");
          img.Image? asstImg =
              img.decodePng(assetImage.buffer.asUint8List().toList());
          asstImg = img.copyResize(asstImg!, height: 192, width: 192);

          final list = toRasterFormat(image);
          final inHex = hex.encode(list);
          final inhexasset = hex.encode(toRasterFormat(asstImg)).toUpperCase();

          final header =
              Uint8List.fromList([0x02, 0x07, 0x04, 0x00, 0x01, 0xC2, 0x00]);
          final picturePosition =
              Uint8List.fromList([0x02, 0x07, 0x19, 0x03, 0x03]);
          final data = list;
          final pictureEnd = Uint8List.fromList([0x02, 0x07, 0x19, 0x00]);
          final footer =
              Uint8List.fromList([0x02, 0x07, 0x04, 0x00, 0x25, 0x80]);

          final builder = BytesBuilder();
          builder.add(header.toList());
          builder.add(picturePosition.toList());
          builder.add(data);
          builder.add(pictureEnd.toList());
          builder.add(footer.toList());

          debugPrint(hex.encode(builder.toBytes().toList()).length.toString());
        },
      ),
    );
  }
}

downloadWeb(Uint8List qrBytes) {
  if (!kIsWeb) {
    final blob = html.Blob([qrBytes.toList()]);
    final url = html.Url.createObjectUrlFromBlob(blob);
    final anchor = html.document.createElement('a') as html.AnchorElement
      ..href = url
      ..style.display = 'none'
      ..download = 'item_export.png';
    html.document.body!.children.add(anchor);
    anchor.click();
    html.Url.revokeObjectUrl(url);
  }
}

printSet(String temp) {
  debugPrint(Set.from(temp.characters).toString());
}

bool areListsEqual(var list1, var list2) {
  // check if both are lists
  if (!(list1 is List && list2 is List)
      // check if both have same length
      ||
      list1.length != list2.length) {
    return false;
  }

  // check if elements are equal
  for (int i = 0; i < list1.length; i++) {
    if (list1[i] != list2[i]) {
      return false;
    }
  }

  return true;
}
